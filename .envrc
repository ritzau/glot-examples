# Nix Polyglot Environment Setup

# Install or update glot CLI if needed
if [[ ! -f .cache/bin/glot ]] || [[ flake.lock -nt .cache/bin/glot ]]; then
    echo "ðŸ”„ Updating glot CLI..."
    mkdir -p .cache/bin
    nix build .#glot-cli -o result-glot-cli
    chmod +w .cache/bin/glot 2>/dev/null || true  # Make writable if exists
    cp result-glot-cli/bin/glot .cache/bin/glot
    rm result-glot-cli
    echo "âœ… Glot CLI updated"
fi

# Add glot to PATH (fast)
PATH_add .cache/bin

# Install git hooks only if they don't exist (slow, so conditional)
if [[ ! -f .git/hooks/pre-commit ]] || [[ ! -f .git/hooks/pre-push ]]; then
    echo "Installing git hooks..."
    nix run .#install-hooks
fi